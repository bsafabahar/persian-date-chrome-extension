<!DOCTYPE html>
<html>
<head>
    <title>Identify 1404/02/31 Bug</title>
    <script src="lib/persian-date.js"></script>
</head>
<body>
    <h1>Finding the 1404/02/31 Bug</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        // Test specific dates around where Persian month 2 would end
        const testDates = [
            '2025-05-20', '2025-05-21', '2025-05-22', '2025-05-23', 
            '2025-05-24', '2025-05-25', '2025-05-26', '2025-05-27',
            '2025-05-28', '2025-05-29', '2025-05-30', '2025-05-31'
        ];
        
        testDates.forEach(dateStr => {
            try {
                const date = new Date(dateStr);
                const [jYear, jMonth, jDay] = PersianDate.toJalali(date);
                const result = `${jYear}/${jMonth.toString().padStart(2, '0')}/${jDay.toString().padStart(2, '0')}`;
                
                let color = 'green';
                let warning = '';
                
                // Check for invalid Persian dates
                if (jMonth === 2 && jDay > 31) {
                    color = 'red';
                    warning = ' ‚ùå INVALID: Month 2 cannot have > 31 days';
                } else if (jMonth > 6 && jMonth < 12 && jDay > 30) {
                    color = 'red';
                    warning = ' ‚ùå INVALID: Months 7-11 cannot have > 30 days';
                } else if (jMonth === 12 && jDay > 30) {
                    color = 'red';
                    warning = ' ‚ùå INVALID: Month 12 cannot have > 30 days';
                } else if (jDay === 0) {
                    color = 'red';
                    warning = ' ‚ùå INVALID: Day cannot be 0';
                }
                
                output.innerHTML += `<p style="color: ${color};">${dateStr} ‚Üí ${result}${warning}</p>`;
                
                if (result === '1404/02/31') {
                    output.innerHTML += `<p style="color: red; font-weight: bold;">üéØ FOUND THE BUG! ${dateStr} produces 1404/02/31</p>`;
                }
                
            } catch (error) {
                output.innerHTML += `<p style="color: red;">${dateStr}: ERROR - ${error.message}</p>`;
            }
        });
        
        // Also test the edge of month 1 to month 2
        output.innerHTML += '<h2>Testing Month 1 to Month 2 Boundary</h2>';
        const boundaryDates = [
            '2025-04-19', '2025-04-20', '2025-04-21', '2025-04-22'
        ];
        
        boundaryDates.forEach(dateStr => {
            try {
                const date = new Date(dateStr);
                const [jYear, jMonth, jDay] = PersianDate.toJalali(date);
                const result = `${jYear}/${jMonth.toString().padStart(2, '0')}/${jDay.toString().padStart(2, '0')}`;
                output.innerHTML += `<p>${dateStr} ‚Üí ${result}</p>`;
            } catch (error) {
                output.innerHTML += `<p style="color: red;">${dateStr}: ERROR - ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>
