<!DOCTYPE html>
<html>
<head>
    <title>Debug Persian Date Conversion</title>
    <script src="lib/persian-date.js"></script>
</head>
<body>
    <h1>Debug Persian Date Conversion</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function testConversion(dateStr, description) {
            try {
                const date = new Date(dateStr);
                console.log(`Testing: ${description} - ${dateStr}`);
                console.log(`Parsed date: ${date}`);
                
                if (isNaN(date.getTime())) {
                    output.innerHTML += `<p style="color: red;">${description}: Invalid date - ${dateStr}</p>`;
                    return;
                }
                
                const [jYear, jMonth, jDay] = PersianDate.toJalali(date);
                const result = `${jYear}/${jMonth.toString().padStart(2, '0')}/${jDay.toString().padStart(2, '0')}`;
                
                // Validate result
                let isValid = true;
                let validationMessage = '';
                
                if (jMonth === 2 && jDay > 31) {
                    isValid = false;
                    validationMessage = ' (INVALID: Month 2 cannot have more than 31 days)';
                } else if (jMonth > 6 && jMonth < 12 && jDay > 30) {
                    isValid = false;
                    validationMessage = ' (INVALID: Months 7-11 cannot have more than 30 days)';
                } else if (jMonth === 12 && jDay > 30) {
                    isValid = false;
                    validationMessage = ' (INVALID: Month 12 cannot have more than 30 days)';
                }
                
                const color = isValid ? 'green' : 'red';
                output.innerHTML += `<p style="color: ${color};">${description}: ${dateStr} â†’ ${result}${validationMessage}</p>`;
                
            } catch (error) {
                output.innerHTML += `<p style="color: red;">${description}: ERROR - ${error.message}</p>`;
                console.error(error);
            }
        }
        
        // Test problematic dates that might cause 1404/02/31
        testConversion('2025-05-21', 'May 21, 2025');
        testConversion('2025-05-22', 'May 22, 2025');
        testConversion('2025-05-23', 'May 23, 2025');
        testConversion('2025-05-31', 'May 31, 2025');
        
        // Test around Persian month boundaries
        testConversion('2025-04-20', 'April 20, 2025');
        testConversion('2025-04-21', 'April 21, 2025');
        testConversion('2025-05-20', 'May 20, 2025');
        testConversion('2025-05-21', 'May 21, 2025');
        testConversion('2025-05-22', 'May 22, 2025');
        
        // Test dates that might convert to 1404/02/31
        for (let day = 20; day <= 31; day++) {
            if (day <= 30 || day === 31) {
                try {
                    testConversion(`2025-05-${day}`, `May ${day}, 2025`);
                } catch (e) {
                    // Ignore invalid dates
                }
            }
        }
    </script>
</body>
</html>